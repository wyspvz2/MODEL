# PyTorch 图像变换示例：ToTensor + Normalize

本文通过 **灰度图（单通道）** 和 **RGB 图（三通道）** 的例子，详细演示了  
`transforms.ToTensor()` 和 `transforms.Normalize()` 的具体张量计算过程。

---

## 1. 灰度图（单通道）例子

假设一张 2×2 的灰度图，像素值（uint8）是：

[[  0, 128],
 [ 64, 255]]

### Step 1: 转张量 (ToTensor)

```python
from torchvision import transforms
import numpy as np
from PIL import Image

# 模拟灰度图
arr = np.array([[0, 128],
                [64, 255]], dtype=np.uint8)
img = Image.fromarray(arr, mode='L')

to_tensor = transforms.ToTensor()
t = to_tensor(img)  # torch.Size([1, 2, 2])
print(t)
```

输出（除以 255，范围 [0,1]，并转成 [C,H,W]）：

tensor([[[0.0000, 0.5020],
         [0.2510, 1.0000]]])

---

### Step 2: 归一化 (Normalize((0.5,), (0.5,)))

归一化公式：

out = (x - 0.5) / 0.5 = 2x - 1

逐像素计算：

- 0.0000 → (0 - 0.5)/0.5 = -1.0  
- 0.5020 → (0.502 - 0.5)/0.5 ≈ 0.0039  
- 0.2510 → (0.251 - 0.5)/0.5 ≈ -0.4980  
- 1.0000 → (1 - 0.5)/0.5 = 1.0  

结果张量：

tensor([[[-1.0000,  0.0039],
         [-0.4980,  1.0000]]])

这样 [0,255] 区间的灰度值被映射到 [-1,1]。

---

## 2. RGB 图（三通道）例子

假设我们有一个 2×2 的彩色图像，每个像素是 [R,G,B]：

[[ [  0,   0,   0],   [255, 128,  64] ],
 [ [128, 255,   0],   [ 64,  64, 255] ]]

---

### Step 1: 转张量 (ToTensor)

```python
arr = np.array([[[  0,   0,   0], [255, 128,  64]],
                [[128, 255,   0], [ 64,  64, 255]]], dtype=np.uint8)
img = Image.fromarray(arr, mode='RGB')

to_tensor = transforms.ToTensor()
t = to_tensor(img)  # torch.Size([3, 2, 2])
print(t)
```

输出（每个通道分别除以 255）：

tensor([[[0.0000, 1.0000],
         [0.5020, 0.2510]],    # R 通道

        [[0.0000, 0.5020],
         [1.0000, 0.2510]],    # G 通道

        [[0.0000, 0.2510],
         [0.0000, 1.0000]]])   # B 通道

---

### Step 2: 归一化 (Normalize((0.5,0.5,0.5),(0.5,0.5,0.5)))

对每个通道都用公式： out = (x - 0.5)/0.5 = 2x - 1

#### R 通道：
[[-1.0000,  1.0000],
 [ 0.0039, -0.4980]]

#### G 通道：
[[-1.0000,  0.0039],
 [ 1.0000, -0.4980]]

#### B 通道：
[[-1.0000, -0.4980],
 [-1.0000,  1.0000]]

结果张量：

tensor([[[ -1.0000,  1.0000],
         [ 0.0039, -0.4980]],

        [[ -1.0000,  0.0039],
         [ 1.0000, -0.4980]],

        [[ -1.0000, -0.4980],
         [-1.0000,  1.0000]]])
